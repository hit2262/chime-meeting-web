<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Amazon Chime Join</title>
</head>
<body>
  <h2>íšŒì˜ ì°¸ê°€ ì¤‘...</h2>
  <video id="video" autoplay muted playsinline style="width: 100%; max-width: 400px; border: 1px solid #ccc;"></video>

  <!-- Chime SDK ë¡œë”© -->
  <script src="https://unpkg.com/amazon-chime-sdk-js@3.0.1/build/amazon-chime-sdk.min.js"></script>

  <script>
    // Chime SDK ê°ì²´ êµ¬ì¡° ë¶„í•´ í• ë‹¹
    const {
      ConsoleLogger,
      DefaultDeviceController,
      DefaultMeetingSession,
      LogLevel,
      MeetingSessionConfiguration
    } = ChimeSDK;

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const meetingId = urlParams.get('meetingId');
    const attendeeId = urlParams.get('attendeeId');
    const joinToken = urlParams.get('joinToken');

    // MeetingSession ì„¤ì •
    const meetingSessionConfiguration = new MeetingSessionConfiguration(
      {
        MeetingId: meetingId,
        MediaRegion: 'ap-northeast-2'
      },
      {
        AttendeeId: attendeeId,
        JoinToken: joinToken
      }
    );

    const logger = new ConsoleLogger('ChimeLogs', LogLevel.INFO);
    const deviceController = new DefaultDeviceController(logger);

    const meetingSession = new DefaultMeetingSession(
      meetingSessionConfiguration,
      logger,
      deviceController
    );

    async function startMeeting() {
      try {
        await meetingSession.audioVideo.start();

        // ì¹´ë©”ë¼ ë°”ì¸ë”©
        const videoElement = document.getElementById("video");
        meetingSession.audioVideo.bindVideoElement("video", videoElement);

        // ë¡œì»¬ ë¹„ë””ì˜¤ ì‹œì‘
        const devices = await meetingSession.audioVideo.listVideoInputDevices();
        if (devices.length > 0) {
          await meetingSession.audioVideo.chooseVideoInputDevice(devices[0].deviceId);
          await meetingSession.audioVideo.startLocalVideoTile();
        }

        console.log("ğŸ‰ íšŒì˜ ì°¸ê°€ ì™„ë£Œ");
      } catch (err) {
        console.error("âŒ íšŒì˜ ì°¸ê°€ ì¤‘ ì˜¤ë¥˜:", err);
      }
    }

    startMeeting();
  </script>
</body>
</html>
