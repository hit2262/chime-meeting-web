<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Amazon Chime Join</title>
</head>
<body>
  <h2>íšŒì˜ ì°¸ê°€ ì¤‘...</h2>
  <video id="video" autoplay muted playsinline style="width: 100%; max-width: 400px; border: 1px solid #ccc;"></video>

  <!-- âœ… Chime SDK ë¶ˆëŸ¬ì˜¤ê¸° -->
  <script src="https://unpkg.com/amazon-chime-sdk-js@3.0.1/build/amazon-chime-sdk.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // âœ… ChimeSDK ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ì—†ìŒ, ê°ì²´ë“¤ ì§ì ‘ ì ‘ê·¼í•´ì•¼ í•¨
      const {
        ConsoleLogger,
        DefaultDeviceController,
        DefaultMeetingSession,
        LogLevel,
        MeetingSessionConfiguration
      } = window;

      const urlParams = new URLSearchParams(window.location.search);
      const meetingId = urlParams.get('meetingId');
      const attendeeId = urlParams.get('attendeeId');
      const joinToken = urlParams.get('joinToken');

      const meetingSessionConfiguration = new MeetingSessionConfiguration(
        {
          MeetingId: meetingId,
          MediaRegion: 'ap-northeast-2'
        },
        {
          AttendeeId: attendeeId,
          JoinToken: joinToken
        }
      );

      const logger = new ConsoleLogger('ChimeLogs', LogLevel.INFO);
      const deviceController = new DefaultDeviceController(logger);

      const meetingSession = new DefaultMeetingSession(
        meetingSessionConfiguration,
        logger,
        deviceController
      );

      try {
        await meetingSession.audioVideo.start();

        const videoElement = document.getElementById("video");
        meetingSession.audioVideo.bindVideoElement("video", videoElement);

        const devices = await meetingSession.audioVideo.listVideoInputDevices();
        if (devices.length > 0) {
          await meetingSession.audioVideo.chooseVideoInputDevice(devices[0].deviceId);
          await meetingSession.audioVideo.startLocalVideoTile();
        }

        console.log("ğŸ‰ íšŒì˜ ì°¸ê°€ ì™„ë£Œ");
      } catch (err) {
        console.error("âŒ íšŒì˜ ì°¸ê°€ ì¤‘ ì˜¤ë¥˜:", err);
      }
    });
  </script>
</body>
</html>
